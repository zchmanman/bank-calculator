<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>银行保函手续费计算器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
    
    <!-- 内联数据区 -->
    <script>
        const bankData = {
            '建行': {
                name: '中国建设银行',
                rate: 0.4,
                rateUnit: '年',
                minFee: 500,
                maxMinFee: 800,
                calculationMethod: 'monthly',
                description: '0.4%/年收取，最低每笔500-800元',
                notes: '按月收费，不足一月的，按一月计算，整年或365天按年利率计算',
                marginPolicy: '无保证金'
            },
            '农行': {
                name: '中国农业银行',
                tiers: [
                    { min: 100000, max: 10000000, rate: 0.3, description: "10万-1000万: 0.3%/年" },
                    { min: 10000000, max: 50000000, rate: 0.15, description: "1000万-5000万: 0.15%/年" },
                    { min: 50000000, max: Infinity, rate: 0.1, description: "5000万以上: 0.1%/年" }
                ],
                rateUnit: '年',
                calculationMethod: 'daily',
                description: '分级费率',
                notes: '按天收费，包含开出当天，整年或365天按年利率计算',
                marginPolicy: '无保证金'
            },
            '宁波': {
                name: '宁波银行',
                tiers: [
                    { min: 0, max: 100000, rate: 300, isFixed: true, description: "0-10万: 固定300元/季" },
                    { min: 100000, max: 5000000, rate: 0.15, description: "10万-500万: 0.15%/季" },
                    { min: 5000000, max: 10000000, rate: 0.125, description: "500万-1000万: 0.125%/季" },
                    { min: 10000000, max: Infinity, rate: 0, isNegotiated: true, description: "1000万以上: 协商确定" }
                ],
                rateUnit: '季',
                annualRate: {
                    0: 1200,  // 对应固定费用300元/季的年费用
                    0.15: 0.6,  // 季度0.15%对应年度0.6%
                    0.125: 0.5  // 季度0.125%对应年度0.5%
                },
                calculationMethod: 'quarterly',
                description: '分级费率',
                notes: '按季收费，不足一季的，按一季计算，整年或365天按年利率计算',
                marginPolicy: '无保证金'
            },
            '浦发': {
                name: '上海浦东发展银行',
                rate: 0.05,  // 季度费率
                rateUnit: '季',
                annualRate: 0.2,  // 年度费率(季度0.05%×4)
                minFee: 500,  // 最低500元/季
                annualMinFee: 2000,  // 最低2000元/年
                calculationMethod: 'quarterly',
                description: '0.05%/季收取，最低每笔500元',
                notes: '按季收费，不足一季的，按一季计算，整年或365天按年利率计算',
                marginPolicy: '固定保证金'
            }
        };

        // 初始化日期为宁波银行测试案例
        const testStartDate = new Date(2024, 11, 31); // 2024/12/31
        const testEndDate = new Date(2025, 11, 31);   // 2025/12/31 (正好一年)

        // 格式化日期为YYYY-MM-DD
        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }
    </script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- 标题区域 -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">
                <i class="fas fa-calculator text-blue-600 mr-3"></i>
                银行保函手续费计算器
            </h1>
            <p class="text-gray-600 text-lg">快速计算各大银行保函手续费，支持多种费率结构</p>
        </div>

        <!-- 费率标准说明 -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-info-circle text-blue-600 mr-2"></i>
                费率标准说明
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500">
                   <h3 class="font-bold text-blue-800 mb-2">中国建设银行</h3>
                    <p class="text-sm text-gray-600 mb-2">0.4%/年</p>
                    <p class="text-sm text-gray-600 mb-2">最低500-800元/笔</p>
                    <p class="text-xs text-gray-500">按月收费，不足一月按一月计算</p>
                    <p class="text-xs text-green-600 mt-2"><i class="fas fa-shield-alt mr-1"></i>无保证金</p>
                </div>
                <div class="bg-green-50 p-4 rounded-lg border-l-4 border-green-500">
                    <h3 class="font-bold text-green-800 mb-2">中国农业银行</h3>
                    <p class="text-sm text-gray-600 mb-2">100万-1000万: 0.3%/年</p>
                    <p class="text-sm text-gray-600 mb-2">1000万-5000万: 0.15%/年</p>
                    <p class="text-sm text-gray-600 mb-2">5000万以上: 0.1%/年</p>
                    <p class="text-xs text-gray-500">按天收费</p>
                    <p class="text-xs text-green-600 mt-2"><i class="fas fa-shield-alt mr-1"></i>无保证金</p>
                </div>
                <div class="bg-yellow-50 p-4 rounded-lg border-l-4 border-yellow-500">
                    <h3 class="font-bold text-yellow-800 mb-2">宁波银行</h3>
                    <p class="text-sm text-gray-600 mb-2">10万以下: 300元/季</p>
                    <p class="text-sm text-gray-600 mb-2">10万-500万: 0.15%/季</p>
                    <p class="text-sm text-gray-600 mb-2">500万-1000万: 0.125%/季</p>
                    <p class="text-xs text-gray-500">按季收费，不足一季按一季计算</p>
                    <p class="text-xs text-green-600 mt-2"><i class="fas fa-shield-alt mr-1"></i>无保证金</p>
                </div>
                <div class="bg-purple-50 p-4 rounded-lg border-l-4 border-purple-500">
                    <h3 class="font-bold text-purple-800 mb-2">上海浦东发展银行</h3>
                    <p class="text-sm text-gray-600 mb-2">正常费率: 0.05%/季</p>
                    <p class="text-sm text-gray-600 mb-2">最低费用: 500元/季</p>
                    <p class="text-xs text-gray-500">按季收费，不足一季按一季计算</p> 
                    <p class="text-xs text-green-600 mt-2"><i class="fas fa-shield-alt mr-1"></i>30%保证金</p>
                </div>
            </div>
        </div>

        <!-- 计算器主体 -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- 输入表单 -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-cog text-blue-600 mr-2"></i>
                        计算参数设置
                    </h2>
                    
                    <form id="calculatorForm" class="space-y-6">
                        <!-- 银行选择 -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-700">
                                    <i class="fas fa-building text-blue-600 mr-1"></i>
                                    选择银行
                                </label>
                                <select id="bankSelect" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                    <option value="建行">中国建设银行</option>
                                    <option value="农行">中国农业银行</option>
                                    <option value="宁波" selected>宁波银行</option>
                                    <option value="浦发">上海浦东发展银行</option>
                                </select>
                            </div>
                            
                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-700">
                                    <i class="fas fa-money-bill-wave text-green-600 mr-1"></i>
                                    保函金额 (元)
                                </label>
                                <input type="number" id="amountInput" placeholder="请输入保函金额" min="0" step="1000" value="5000000" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                            </div>
                        </div>
                        
                        <!-- 日期选择 -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-700">
                                    <i class="fas fa-calendar-alt text-orange-600 mr-1"></i>
                                    保函起始日
                                </label>
                                <input type="date" id="startDateInput" value="2024-12-31" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                            </div>
                            
                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-700">
                                    <i class="fas fa-calendar-times text-red-600 mr-1"></i>
                                    保函到期日
                                </label>
                                <input type="date" id="endDateInput" value="2025-12-31" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                            </div>
                        </div>
                        
                        <!-- 日期差显示 -->
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h3 class="font-semibold text-gray-800 mb-2 flex items-center">
                                <i class="fas fa-calendar-check text-blue-600 mr-2"></i>
                                期限信息
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="space-y-1">
                                    <span class="text-sm text-gray-600">实际天数：</span>
                                    <span id="daysDifference" class="font-medium"></span>
                                </div>
                                <div class="space-y-1">
                                    <span class="text-sm text-gray-600">是否按年计算：</span>
                                    <span id="isAnnualIndicator" class="font-medium"></span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 保证金设置 -->
                        <div id="marginSection" class="space-y-4 bg-gray-50 p-4 rounded-lg">
                            <h3 class="font-semibold text-gray-800 flex items-center">
                                <i class="fas fa-shield-alt text-purple-600 mr-2"></i>
                                保证金信息
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="space-y-2">
                                    <label class="block text-sm font-medium text-gray-700">保证金类型</label>
                                    <input type="text" id="marginType" readonly class="w-full px-4 py-2 rounded-lg border border-gray-300 bg-gray-100">
                                </div>
                                <div class="space-y-2">
                                    <label class="block text-sm font-medium text-gray-700">保证金比例</label>
                                    <input type="text" id="marginRate" readonly class="w-full px-4 py-2 rounded-lg border border-gray-300 bg-gray-100">
                                </div>
                                <div class="space-y-2 md:col-span-2">
                                    <label class="block text-sm font-medium text-gray-700">保证金金额 (元)</label>
                                    <input type="text" id="marginAmount" readonly class="w-full px-4 py-2 rounded-lg border border-gray-300 bg-gray-100 font-semibold text-purple-600">
                                </div>
                            </div>
                        </div>
                        
                        <!-- 计算按钮 -->
                        <div class="text-center">
                            <button type="button" id="calculateBtn" class="px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg shadow-lg transform hover:scale-105 transition-all duration-300">
                                <i class="fas fa-calculator mr-2"></i>
                                计算手续费
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- 计算结果 -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-xl shadow-lg p-6 h-full flex flex-col">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-chart-line text-green-600 mr-2"></i>
                        计算结果
                    </h2>
                    
                    <div id="resultContainer" class="space-y-4 flex-grow">
                        <div class="bg-gray-50 p-4 rounded-lg text-center text-gray-500" id="emptyResult">
                            <i class="fas fa-info-circle text-2xl mb-2"></i>
                            <p>请输入参数并点击计算按钮</p>
                        </div>
                        
                        <div id="resultContent" class="hidden space-y-4">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h3 class="font-semibold text-gray-800 mb-2">银行信息</h3>
                                <p id="resultBankName" class="text-blue-800 font-medium"></p>
                            </div>
                            
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h3 class="font-semibold text-gray-800 mb-2">手续费详情</h3>
                                <div class="space-y-2">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">适用费率区间：</span>
                                        <span id="resultRateTier" class="font-semibold text-green-800"></span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">适用费率：</span>
                                        <span id="resultRate" class="font-semibold text-green-800"></span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">计费方式：</span>
                                        <span id="resultCalculationMethod" class="font-semibold text-green-800"></span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">计费周期：</span>
                                        <span id="resultPeriod" class="font-semibold text-green-800"></span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">基础费用：</span>
                                        <span id="resultBaseFee" class="font-semibold text-green-800"></span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">最低费用：</span>
                                        <span id="resultMinFee" class="font-semibold text-green-800"></span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-yellow-50 p-4 rounded-lg">
                                <h3 class="font-semibold text-gray-800 mb-2">最终费用</h3>
                                <div class="text-center">
                                    <p id="resultFinalFee" class="text-2xl font-bold text-yellow-800"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <div class="bg-red-50 p-4 rounded-lg">
                            <h3 class="font-semibold text-red-800 mb-2 flex items-center">
                                <i class="fas fa-exclamation-triangle mr-2"></i>
                                注意事项
                            </h3>
                            <ul class="text-sm text-red-700 space-y-1">
                                <li>• 本计算结果仅供参考</li>
                                <li>• 实际费用以银行最终结算为准</li>
                                <li>• 期限为一整年或365天时将自动按年利率计算</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 备注信息 -->
        <div class="mt-8 text-center text-gray-500 text-sm">
            <p>本工具仅供参考，实际费用以银行结算为准</p>
        </div>
    </div>

    <script>
        // 初始化日期为测试案例日期
        document.getElementById('startDateInput').value = formatDate(testStartDate);
        document.getElementById('endDateInput').value = formatDate(testEndDate);
        
        // 银行选择或日期变化时更新日期差信息
        document.getElementById('bankSelect').addEventListener('change', updateDateInfo);
        document.getElementById('startDateInput').addEventListener('change', updateDateInfo);
        document.getElementById('endDateInput').addEventListener('change', updateDateInfo);
        document.getElementById('amountInput').addEventListener('input', updateMarginInfo);
        
        // 计算按钮点击事件
        document.getElementById('calculateBtn').addEventListener('click', calculateFee);
        
        // 初始化页面信息
        updateDateInfo();
        updateMarginInfo();
        
        // 更新日期差信息
        function updateDateInfo() {
            const startDate = new Date(document.getElementById('startDateInput').value);
            const endDate = new Date(document.getElementById('endDateInput').value);
            
            if (startDate >= endDate || isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {
                document.getElementById('daysDifference').textContent = '请输入有效的日期范围';
                document.getElementById('isAnnualIndicator').textContent = '-';
                return;
            }
            
            // 计算实际天数差
            const oneDayMs = 24 * 60 * 60 * 1000;
            const diffMs = endDate - startDate;
            const diffDays = Math.ceil(diffMs / oneDayMs);
            
            // 判断是否为一年期
            const isOneYear = isOneYearPeriod(startDate, endDate);
            
            // 更新显示
            document.getElementById('daysDifference').textContent = `${diffDays} 天`;
            document.getElementById('isAnnualIndicator').textContent = isOneYear ? '是' : '否';
        }
        
        // 更新保证金信息
        function updateMarginInfo() {
            const bankKey = document.getElementById('bankSelect').value;
            const amount = parseFloat(document.getElementById('amountInput').value) || 0;
            const bankInfo = bankData[bankKey];
            
            let marginType = '';
            let marginRate = '';
            let marginAmount = 0;
            
            if (bankKey === '浦发') {
                // 浦发银行保证金政策为30%
                marginType = '固定保证金';
                marginRate = '30%';
                marginAmount = amount * 0.3;
            } else {
                // 其他银行保证金政策不变
                marginType = bankInfo.marginPolicy || '无保证金';
                marginRate = '0%';
                marginAmount = 0;
            }
            
            // 更新表单显示
            document.getElementById('marginType').value = marginType;
            document.getElementById('marginRate').value = marginRate;
            document.getElementById('marginAmount').value = marginAmount.toLocaleString('zh-CN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }
        
        /**
         * 判断两个日期是否为一年期（两种情况）
         * 1. 月份和日期完全相同（精确一整年）
         * 2. 两个日期之间正好相差365天（考虑闰年影响）
         */
        function isOneYearPeriod(startDate, endDate) {
            // 创建日期副本避免修改原对象
            const start = new Date(startDate);
            const end = new Date(endDate);
            
            // 情况1: 月份和日期完全相同（精确一整年）
            const isExactYear = end.getFullYear() - start.getFullYear() === 1 &&
                               start.getMonth() === end.getMonth() && 
                               start.getDate() === end.getDate();
                               
            if (isExactYear) {
                return true;
            }
            
            // 情况2: 正好相差365天（毫秒级精确计算）
            const oneDayMs = 24 * 60 * 60 * 1000; // 一天的毫秒数
            const diffMs = end - start;
            const diffDays = diffMs / oneDayMs;
            
            // 考虑浮点计算精度问题，使用微小误差范围判断
            return Math.abs(diffDays - 365) < 0.001;
        }
        
        // 计算两个日期之间的实际月份数
        function calculateMonths(startDate, endDate) {
            // 创建日期副本避免修改原日期对象
            const start = new Date(startDate);
            const end = new Date(endDate);
            
            let months = 0;
            let currentDate = new Date(start);
            
            // 按月递增直到超过结束日期
            while (currentDate <= end) {
                months++;
                currentDate.setMonth(currentDate.getMonth() + 1);
            }
            
            // 确保至少计算为1个月（不足一个月按一个月计算）
            return Math.max(months, 1);
        }
        
        // 计算两个日期之间的实际季度数
        function calculateQuarters(startDate, endDate) {
            // 创建日期副本避免修改原对象
            const start = new Date(startDate);
            const end = new Date(endDate);
            
            // 确保日期有效性
            if (isNaN(start.getTime()) || isNaN(end.getTime())) {
                throw new Error('无效的日期参数');
            }
            
            // 如果开始日期晚于结束日期，返回0
            if (start > end) return 0;
            
            let quarters = 0;
            let current = new Date(start);
            const maxIterations = 1000; // 防止无限循环的安全机制
            let iterations = 0;
            
            // 按季度递增直到超过结束日期
            while (current <= end && iterations < maxIterations) {
                quarters++;
                // 移动到下一个季度的第一天
                const newMonth = current.getMonth() + 3;
                current.setMonth(newMonth);
                
                iterations++;
            }
            
            // 确保至少计算为1个季度（不足一季按一季计算）
            return Math.max(quarters, 1);
        }
        
        // 计算两个日期之间的实际天数，可根据银行设置是否包含起始日
        function calculateDays(startDate, endDate, includeStartDay = false) {
            const oneDay = 24 * 60 * 60 * 1000; // 毫秒
            const diffTime = Math.abs(endDate - startDate);
            const diffDays = Math.ceil(diffTime / oneDay);
            
            // 如果需要包含起始日，天数加1
            return includeStartDay ? diffDays + 1 : diffDays;
        }
        
        // 计算手续费
        function calculateFee() {
            const bankKey = document.getElementById('bankSelect').value;
            const amount = parseFloat(document.getElementById('amountInput').value);
            const startDate = new Date(document.getElementById('startDateInput').value);
            const endDate = new Date(document.getElementById('endDateInput').value);
            
            // 验证输入
            if (isNaN(amount) || amount <= 0) {
                alert('请输入有效的保函金额');
                return;
            }
            
            if (startDate >= endDate || isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {
                alert('请输入有效的日期范围，到期日必须晚于起始日');
                return;
            }
            
            const bankInfo = bankData[bankKey];
            let fee = 0;
            let rate = 0;
            let period = 0;
            let periodText = '';
            let minFee = 0;
            let rateFound = false;
            let currentTier = null;
            let calculationMethodText = '';
            let isAnnual = false;
            let rateTierDescription = '';
            
            // 检查是否为一年期（精确一年或365天）
            const isOneYear = isOneYearPeriod(startDate, endDate);
            
            // 根据银行和金额确定费率
            if (bankInfo.tiers) {
                // 分级费率银行 - 精确匹配金额所在区间
                for (const tier of bankInfo.tiers) {
                    // 检查是否为协商费率
                    if (tier.isNegotiated && amount >= tier.min) {
                        alert(`${bankInfo.name}该金额区间费率需协商确定`);
                        return;
                    }
                    
                    // 匹配金额对应的费率等级（注意处理最大值为Infinity的情况）
                    // 对于临界点（如500万），应属于更高一档费率
                    if (amount >= tier.min && amount < tier.max) {
                        rate = tier.rate;
                        currentTier = tier;
                        rateFound = true;
                        rateTierDescription = tier.description || '';
                        break;
                    }
                }
                
                // 检查是否找到匹配的费率
                if (!rateFound) {
                    alert(`无法找到${bankInfo.name}对应金额的费率信息`);
                    return;
                }
            } else {
                // 固定费率银行
                rate = bankInfo.rate;
                rateFound = true;
                minFee = bankInfo.minFee || 0;
            }
            
            // 如果是一年期，使用年利率计算
            if (isOneYear) {
                isAnnual = true;
                period = 1;
                periodText = '1 年 (365天)';
                calculationMethodText = '按年利率计算';
                
                // 根据不同银行处理年利率
                if (bankKey === '宁波' && currentTier) {
                    // 宁波银行使用对应的年利率
                    if (currentTier.isFixed) {
                        // 固定费用按年度计算（300元/季 × 4季）
                        fee = bankInfo.annualRate[0];
                    } else {
                        // 使用对应的年利率
                        fee = amount * (bankInfo.annualRate[rate] / 100);
                    }
                    minFee = 0; // 宁波银行年度计算无最低费用限制
                } else if (bankKey === '浦发') {
                    // 浦发银行使用年度费率
                    fee = amount * (bankInfo.annualRate / 100);
                    minFee = bankInfo.annualMinFee; // 使用年度最低费用
                } else {
                    // 其他银行直接使用年利率计算
                    fee = amount * (rate / 100);
                    
                    // 建行特殊处理年度最低费用
                    if (bankKey === '建行') {
                        minFee = amount <= 1000000 ? bankInfo.minFee : bankInfo.maxMinFee;
                    }
                }
            } else {
                // 非一年期，按原计算方式
                switch (bankInfo.calculationMethod) {
                    case 'daily':
                        // 按天计算，农业银行特殊处理：包含起始日
                        const includeStartDay = bankKey === '农行';
                        period = calculateDays(startDate, endDate, includeStartDay);
                        periodText = `${period} 天${includeStartDay ? '（包含开出当天）' : ''}`;
                        calculationMethodText = '按天计算';
                        
                        // 按金额和天数计算，使用360天/年标准
                        fee = amount * (rate / 100) * (period / 360);
                        break;
                        
                    case 'monthly':
                        // 按月计算
                        period = calculateMonths(startDate, endDate);
                        periodText = `${period} 个月`;
                        calculationMethodText = '按月计算';
                        
                        fee = amount * (rate / 100) * (period / 12);
                        minFee = bankInfo.minFee;
                        break;
                        
                    case 'quarterly':
                        // 按季计算
                        period = calculateQuarters(startDate, endDate);
                        periodText = `${period} 个季度`;
                        calculationMethodText = '按季计算';
                        
                        if (currentTier && currentTier.isFixed) {
                            // 固定费用，不随季度数变化
                            fee = rate * period;
                        } else {
                            // 按金额和季度计算
                            fee = amount * (rate / 100) * period;
                        }
                        minFee = bankInfo.minFee || 0;
                        break;
                }
            }
            
            // 应用最低费用限制
            if (minFee > 0) {
                fee = Math.max(fee, minFee);
            }
            
            // 建行特殊处理
            if (bankKey === '建行' && !isAnnual) {
                minFee = amount <= 1000000 ? bankInfo.minFee : bankInfo.maxMinFee;
                fee = Math.max(fee, minFee);
            }
            
            // 显示结果
            document.getElementById('emptyResult').classList.add('hidden');
            document.getElementById('resultContent').classList.remove('hidden');
            
            document.getElementById('resultBankName').textContent = bankInfo.name;
            document.getElementById('resultRateTier').textContent = rateTierDescription;
            document.getElementById('resultRate').textContent = isAnnual 
                ? `${bankKey === '浦发' ? bankInfo.annualRate : (bankKey === '宁波' ? bankInfo.annualRate[rate] : rate)}%/年`
                : (currentTier && currentTier.isFixed
                    ? `固定费用 ${rate.toLocaleString('zh-CN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} 元/${bankInfo.rateUnit}` 
                    : `${rate}%/${bankInfo.rateUnit}`);
            document.getElementById('resultCalculationMethod').textContent = calculationMethodText;
            document.getElementById('resultPeriod').textContent = periodText;
            document.getElementById('resultBaseFee').textContent = `${fee.toLocaleString('zh-CN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} 元`;
            document.getElementById('resultMinFee').textContent = minFee > 0 
                ? `${minFee.toLocaleString('zh-CN')} 元/${isAnnual ? '年' : (bankInfo.rateUnit || '笔')}` 
                : '无最低费用';
            document.getElementById('resultFinalFee').textContent = `${fee.toLocaleString('zh-CN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} 元`;
        }
        
        // 自动计算测试案例
        window.addEventListener('load', function() {
            calculateFee();
        });
    </script>
</body>
</html>
    